import{a as B,b as F}from"./chunk-QZINCRWF.js";import{a as A}from"./chunk-F7E72B2R.js";import"./chunk-RM6A764G.js";import{c as P,d as I,e as S,f as D,l as E,n as O,o as T,p as z,r as R}from"./chunk-AE23IOV2.js";import{C as x,F as s,G as n,H as r,I as c,J as h,K as u,N as v,O as m,V as k,W as o,X as b,Y as d,_a as M,ba as C,ga as y,ia as w,v as a,w as f,y as _}from"./chunk-PTDB2MRV.js";import"./chunk-FJRRL5JZ.js";import"./chunk-3C4MD3TU.js";import"./chunk-SUXJXZP3.js";import"./chunk-UHOD3RQT.js";import"./chunk-JWOVPSB7.js";import"./chunk-R5HL6L5F.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-2LSUWKNB.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";function L(i,p){i&1&&(n(0,"div",12),c(1,"ion-spinner",13),o(2," Loading report... "),r())}function U(i,p){if(i&1&&(n(0,"div",14),o(1),r()),i&2){let e=m();a(),d(" ",e.error," ")}}function W(i,p){if(i&1&&(h(0),c(1,"app-bar-chart",27),u()),i&2){let e=m(2);a(),s("habitsData",e.habitsData)}}function $(i,p){i&1&&(n(0,"div",28),o(1,"No habits registered this week."),r())}function N(i,p){if(i&1&&(h(0),n(1,"div",15)(2,"div",16),o(3,"Habits completed this week"),r(),n(4,"div",17),x(5,W,2,1,"ng-container",18)(6,$,2,0,"ng-template",null,0,C),r()(),n(8,"div",19)(9,"div"),c(10,"ion-icon",20),n(11,"span",21),o(12,"Streak:"),r(),n(13,"span",22),o(14),r()(),n(15,"div"),c(16,"ion-icon",23),n(17,"span",24),o(18,"Total completed:"),r(),n(19,"span",25),o(20),r()()(),n(21,"div",26),o(22),r(),u()),i&2){let e=k(7),t=m();a(5),s("ngIf",t.habitsData&&t.habitsData.length>0)("ngIfElse",e),a(9),d("",t.streak," days"),a(6),b(t.totalCompleted),a(2),d(" ",t.motivationalMessage," ")}}var ee=(()=>{class i{constructor(e,t){this.reportService=e,this.authService=t,this.loading=!0,this.error="",this.period="",this.habitsData=[],this.streak=0,this.totalCompleted=0,this.motivationalMessage=""}ngOnInit(){let e=this.authService.getUserIdFromToken();if(!e){this.error="User not authenticated. Please log in again.",this.loading=!1;return}this.loading=!0,this.reportService.getWeeklyReport(e).subscribe({next:t=>{this.processHabitsData(t),this.streak=t?.streak||0,this.totalCompleted=t?.totalCompleted||0,this.period=this.formatPeriod(t?.periodStart,t?.periodEnd),this.motivationalMessage=this.getMotivationalMessage(this.streak,this.totalCompleted),this.loading=!1},error:()=>{this.error="Error fetching report data.",this.loading=!1}})}processHabitsData(e){if(!e){this.habitsData=[];return}let t=[{name:"Sunlight",icon:"sunny"},{name:"Water",icon:"water"},{name:"Air",icon:"leaf"},{name:"Healthy Food",icon:"restaurant"},{name:"Exercise",icon:"walk"},{name:"Temperance",icon:"scale"},{name:"Rest",icon:"moon"},{name:"Trust in God",icon:"heart-circle-outline"}];if(Array.isArray(e.habitsData)){this.habitsData=e.habitsData;return}this.habitsData=t.map(l=>{let g=e[l.name]||[0,0,0,0,0,0,0],H=Array.isArray(g)?g.reduce((j,G)=>j+G,0):0;return{name:l.name,icon:l.icon,weeklyTotal:H}}),this.habitsData=[...this.habitsData]}formatPeriod(e,t){return e&&t?`${this.formatDate(e)} - ${this.formatDate(t)}`:""}formatDate(e){return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}getMotivationalMessage(e,t){return e>=7?"Amazing! You kept your streak all week!":e>=4?`Great job! You kept your streak for ${e} days!`:t>=10?"Good effort! Try to keep your streak for more days next week.":"Let\u2019s try to complete more habits next week!"}goBack(){window.history.back()}static{this.\u0275fac=function(t){return new(t||i)(f(F),f(A))}}static{this.\u0275cmp=_({type:i,selectors:[["app-report"]],decls:18,vars:5,consts:[["noData",""],["slot","start"],[1,"report-back-btn"],["fill","clear",3,"click"],["name","arrow-back-circle"],[3,"fullscreen"],[1,"report-main-container"],[1,"report-title"],[1,"report-period"],["class","report-loading",4,"ngIf"],["class","report-error",4,"ngIf"],[4,"ngIf"],[1,"report-loading"],["name","crescent"],[1,"report-error"],[1,"report-card"],[1,"report-bar-chart-title"],[1,"report-bar-chart"],[4,"ngIf","ngIfElse"],[1,"report-stats-card"],["name","flame",1,"streak-icon"],[1,"streak-label"],[1,"streak-value"],["name","checkmark-circle",1,"stat-icon"],[1,"stat-label"],[1,"stat-value"],[1,"report-message-card"],[3,"habitsData"],[1,"no-data-message"]],template:function(t,l){t&1&&(n(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),c(3,"ion-menu-button"),r(),n(4,"ion-title"),o(5,"Relat\xF3rio"),r()()(),n(6,"div",2)(7,"ion-button",3),v("click",function(){return l.goBack()}),c(8,"ion-icon",4),r()(),n(9,"ion-content",5)(10,"div",6)(11,"div",7),o(12,"Weekly Report"),r(),n(13,"div",8),o(14),r(),x(15,L,3,0,"div",9)(16,U,2,1,"div",10)(17,N,23,5,"ng-container",11),r()()),t&2&&(a(9),s("fullscreen",!0),a(5),b(l.period),a(),s("ngIf",l.loading),a(),s("ngIf",l.error),a(),s("ngIf",!l.loading&&!l.error))},dependencies:[S,w,y,M,R,P,O,B,D,z,I,E,T],styles:[".report-main-container[_ngcontent-%COMP%]{min-height:100vh;background:#d7f1c3;display:flex;flex-direction:column;align-items:center;padding:32px 0}.report-title[_ngcontent-%COMP%]{font-size:2.3rem;font-weight:700;color:#22332a;margin-bottom:12px;text-align:center}.report-card[_ngcontent-%COMP%]{background:#fff;border-radius:24px;box-shadow:0 2px 16px #0000000f;padding:32px 24px 18px;max-width:420px;width:100%;margin-bottom:28px;margin-top:0;display:flex;flex-direction:column;align-items:center}.no-data-message[_ngcontent-%COMP%]{width:100%;text-align:center;color:#7a8c7a;font-size:1.15rem;padding:32px 0;font-style:italic}.report-stats-card[_ngcontent-%COMP%]{background:#f8fbf6;border-radius:16px;box-shadow:0 1px 4px #00000008;padding:18px 18px 10px;max-width:420px;width:100%;margin:0 auto 18px;display:flex;flex-direction:row;justify-content:space-around;align-items:center;gap:18px}.streak-label[_ngcontent-%COMP%], .stat-label[_ngcontent-%COMP%]{color:#4b6e5c;font-weight:500;margin-left:4px}.streak-value[_ngcontent-%COMP%], .stat-value[_ngcontent-%COMP%]{color:#22332a;font-weight:700;margin-left:2px}.streak-icon[_ngcontent-%COMP%]{color:#ff7043;font-size:1.5rem;margin-right:6px}.stat-icon[_ngcontent-%COMP%]{color:#388e3c;font-size:1.3rem;margin-right:2px}.report-message-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;box-shadow:0 2px 8px #0000000a;padding:22px 18px;max-width:420px;width:100%;font-size:1.35rem;color:#22332a;text-align:center;font-weight:500}.report-back-btn[_ngcontent-%COMP%]{position:absolute;top:18px;left:12px;z-index:10}.report-back-btn[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background: transparent;--box-shadow: none;font-size:2rem;padding:0}.report-period[_ngcontent-%COMP%]{font-size:1.1rem;color:#4b6e5c;text-align:center;margin-bottom:18px}.report-loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:32px 0;font-size:1.2rem;color:#22332a}.report-error[_ngcontent-%COMP%]{color:#d32f2f;text-align:center;margin:24px 0;font-size:1.1rem}.report-bar-chart-title[_ngcontent-%COMP%]{font-size:1.15rem;color:#176b3a;font-weight:600;margin-bottom:8px;text-align:center}@media (max-width: 600px){.report-card[_ngcontent-%COMP%]{padding:20px 6px 12px;max-width:98vw}.report-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:8px}.report-period[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:10px}}"]})}}return i})();export{ee as ReportPage};
